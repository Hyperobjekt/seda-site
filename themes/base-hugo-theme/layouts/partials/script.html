{{ $jquery := resources.Get "js/lib/jquery.min.js" }}
{{ $anime := resources.Get "js/lib/anime.min.js" }}
{{ $bootstrap := resources.Get "js/lib/bootstrap.bundle.min.js" }}
{{ $js := slice $jquery $bootstrap $anime | resources.Concat "js/bundle.min.js" | fingerprint }}
<script src="{{ $js.Permalink }}"></script>

{{ if .Site.IsServer }}
  {{ $opts := dict "noComments" false "minified" false }}
  {{ $custom := resources.Get "js/src/seda-custom.js" | babel $opts }}
  {{ $analytics := resources.Get "js/src/analytics.js" | babel $opts }}
  {{ $scrollDepth := resources.Get "js/lib/scrollDepth.js" }}
  {{ $localslice := slice $scrollDepth $analytics $custom }}
  <!-- If site is being served (ostensibly dev) don't compress and minify -->
  {{ if eq .Site.Params.loadDevAnalytics true }}
    <!-- Load GA script to track scroll depth -->
    {{ $localjs := $localslice | resources.Concat "js/local.js" | fingerprint }}
    {{ template "_internal/google_analytics_async.html" }}
    <script src="{{ $localjs.Permalink }}"></script>
  {{ else }}
    {{ $localslice := slice $custom }}
    {{ $localjs := $localslice | resources.Concat "js/local.js" | fingerprint }}
    <script src="{{ $localjs.Permalink }}"></script>
  {{ end }}
{{ else }}
  {{ $opts := dict "noComments" true "minified" true }}
  {{ $custom := resources.Get "js/src/seda-custom.js" | babel $opts }}
  {{ $analytics := resources.Get "js/src/analytics.js" | babel $opts }}
  {{ $scrollDepth := resources.Get "js/lib/scrollDepth.js" }}
  {{ template "_internal/google_analytics_async.html" }}
  {{ $localslice := slice $scrollDepth $analytics $custom }}
  {{ $localjs := $localslice | resources.Concat "js/local.min.js" | fingerprint }}
  <script src="{{ $localjs.Permalink }}"></script>
{{ end }}

{{ if (and ( eq .Page.Type "discoveries" ) ( eq .Page.Kind "page" )) }}
    {{ partial "scatterplot-scripts.html" . }}
{{ end }}
{{ if eq .Page.Name "Get the Data" }}
  {{ partial "subscribe-scripts.html" . }}
{{ end }}
{{ if (and ( eq .Page.Type "media-map" ) ( eq .Page.Kind "section" )) }}
  {{ partial "media-map.html" . }}
{{ end }}
{{/*
<script>
// Used for testing GA reporting of JS errors.
const timeout = setTimeout(function() {
  console.log(_t_);
}, 4000);
</script>
*/}}
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
