"use strict";function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}/* use strict */var _plot={};_plot.searchItemIDs=[],function(a){var b={scatterplot:null,wrappers:[],top:null,height:null,bottom:null,isTransitional:!1,activeState:"state1",// searchItemIDs: [],
searchEl:null,searchProps:{// Props passed in to init the search input(s)
algoliaId:"QPJ12WSVR4",algoliaKey:"bae9e4604dbd263cc47c48bfb30dd5dc",onSuggestionSelected:function onSuggestionSelected(a){_plot&&_plot.searchItemIDs&&(_plot.searchItemIDs[0]=a),scatterplot.loadState(b.activeState);!!dataLayer&&3<=dataLayer.length?dataLayer.push({event:"districtHighlighted",highlightedDistrict:a.name}):console.log("dataLayer not available. Skipping analytics reporting for highlighted item select.")},onSelectedClear:function onSelectedClear(){// console.log(e);
// Clear search item array
// Reload state
searchItemIDs=[],scatterplot.loadState(b.activeState)},indices:["districts"],inputProps:{placeholder:"Highlight a district...","aria-label":"Enter a district name to search"}},renderSearch:function renderSearch(){// $elements = $('.search-component');
// $elements.each(function(el) {
//   (plot.searchEl).push(new plot.searchInit(plot.searchProps, el));
// });
var a=document.getElementById("searchComponent");b.searchEl=new b.searchInit(b.searchProps,a)},searchInit:function searchInit(a,b){var c=this,d=_extends(a,{ref:function ref(a){c.component=a}});// add reference to the component to props
this.render=function(a){ReactDOM.render(React.createElement(SedaSearch,a,null),b)},this.render(d)},update:function update(){// console.log('update');
var c=a.grep(b.wrappers,function(c){b.top=b.scatterplot.offset().top+120;// + 462;
var d=a(c).offset().top,e=a(c).outerHeight();// $(el).offset().top - $(window).scrollTop();
// var wrapperHeight = $(el).height();
// If plot top or bottom are within
// add to activeWrappers.
// console.log('plot.top = ' + plot.top);
// console.log('offset().top = ' + $(el).offset().top);
// console.log('scrolltop = ' + $(window).scrollTop());
// console.log('wrapperTop = ' + wrapperTop);
// console.log('wrapperBottom = ' + wrapperBottom);
if(b.top>=d&&b.top<=+d+ +e)// console.log('It\'s within a wrapper.');
return a(c)});// console.log(activeWrappers);
if(1==c.length){b.scatterplot.removeClass("transitional"),b.isTransitional=!1;// Set state to the first one.
// console.log(activeWrappers[0]);
var d=a(c[0]).attr("data-plot-state"),e=!!a(c[0]).attr("data-plot-notmerge")&&a(c[0]).attr("data-plot-notmerge");d!==b.activeState&&(console.log("loading new state "+d),e?scatterplot.loadState(d,{notMerge:!0}):scatterplot.loadState(d),b.activeState=d)}else(0===c.length||1<=c.length)&&(b.scatterplot.addClass("transitional"),b.isTransitional=!0)},getCoords:function getCoords(){b.top=b.scatterplot.offset().top,b.height=b.scatterplot.find("> div").height(),b.bottom=+b.top+ +b.height}};// Get top and bottom y coords of the scatterplot
// Reset them if the screen is resized
// Only trigger scroll ever 50ms so less resources
b.scatterplot=a("#scatterplot"),b.wrappers=a(".state-desc-wrapper"),b.getCoords(),a(window).resize(function(){// plot.top = (plot.scatterplot).offset().top;
// plot.height = (plot.scatterplot).find('> div').height();
// plot.bottom = Number(plot.top) + Number(plot.height);
b.getCoords()}),scatterplot.on("ready",function(){var c=!1;a(window).scroll(function(){c=!0}),setInterval(function(){c&&(b.update(),c=!1)},50),1<=a(".search-component").length&&b.renderSearch()}),scatterplot.loadState("state1")}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY2F0dGVycGxvdC9wbG90LmpzIl0sIm5hbWVzIjpbIl9wbG90Iiwic2VhcmNoSXRlbUlEcyIsIiQiLCJwbG90Iiwic2NhdHRlcnBsb3QiLCJ3cmFwcGVycyIsInRvcCIsImhlaWdodCIsImJvdHRvbSIsImlzVHJhbnNpdGlvbmFsIiwiYWN0aXZlU3RhdGUiLCJzZWFyY2hFbCIsInNlYXJjaFByb3BzIiwiYWxnb2xpYUlkIiwiYWxnb2xpYUtleSIsIm9uU3VnZ2VzdGlvblNlbGVjdGVkIiwiaGl0IiwibG9hZFN0YXRlIiwiZGF0YUxheWVyIiwibGVuZ3RoIiwicHVzaCIsImNvbnNvbGUiLCJsb2ciLCJvblNlbGVjdGVkQ2xlYXIiLCJpbmRpY2VzIiwiaW5wdXRQcm9wcyIsInBsYWNlaG9sZGVyIiwicmVuZGVyU2VhcmNoIiwicm9vdEVsIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInNlYXJjaEluaXQiLCJwcm9wcyIsImNvbnRhaW5lciIsIl9zZWxmIiwicmVmUHJvcHMiLCJyZWYiLCJjb21wb25lbnQiLCJyZW5kZXIiLCJSZWFjdERPTSIsIlJlYWN0IiwiY3JlYXRlRWxlbWVudCIsIlNlZGFTZWFyY2giLCJ1cGRhdGUiLCJhY3RpdmVXcmFwcGVycyIsImdyZXAiLCJlbCIsIm9mZnNldCIsIndyYXBwZXJUb3AiLCJ3cmFwcGVySGVpZ2h0Iiwib3V0ZXJIZWlnaHQiLCJyZW1vdmVDbGFzcyIsInN0YXRlIiwiYXR0ciIsIm5vdG1lcmdlIiwibm90TWVyZ2UiLCJhZGRDbGFzcyIsImdldENvb3JkcyIsImZpbmQiLCJ3aW5kb3ciLCJyZXNpemUiLCJvbiIsInVzZXJTY3JvbGxlZCIsInNjcm9sbCIsInNldEludGVydmFsIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiK09BQUEsZ0JBRUEsR0FBTUEsQ0FBQUEsS0FBSyxDQUFHLEVBQWQsQ0FDQUEsS0FBSyxDQUFDQyxhQUFOLENBQXNCLEUsQ0FFckIsU0FBU0MsQ0FBVCxDQUFZLENBRVQsR0FBTUMsQ0FBQUEsQ0FBSSxDQUFHLENBQ1RDLFdBQVcsQ0FBRSxJQURKLENBRVRDLFFBQVEsQ0FBRSxFQUZELENBR1RDLEdBQUcsQ0FBRSxJQUhJLENBSVRDLE1BQU0sQ0FBRSxJQUpDLENBS1RDLE1BQU0sQ0FBRSxJQUxDLENBTVRDLGNBQWMsR0FOTCxDQU9UQyxXQUFXLENBQUUsUUFQSixDQVFUO0FBQ0FDLFFBQVEsQ0FBRSxJQVRELENBVVRDLFdBQVcsQ0FBRSxDQUFFO0FBQ2JDLFNBQVMsQ0FBRSxZQURBLENBRVhDLFVBQVUsQ0FBRSxrQ0FGRCxDQUdYQyxvQkFBb0IsQ0FBRSw4QkFBU0MsQ0FBVCxDQUFjLENBRzlCaEIsS0FBSyxFQUFJQSxLQUFLLENBQUNDLGFBSGUsR0FJaENELEtBQUssQ0FBQ0MsYUFBTixDQUFvQixDQUFwQixFQUF5QmUsQ0FKTyxFQU9sQ1osV0FBVyxDQUFDYSxTQUFaLENBQXNCZCxDQUFJLENBQUNPLFdBQTNCLENBUGtDLENBVTlCLENBQUMsQ0FBQ1EsU0FBRixFQUFvQyxDQUFwQixFQUFBQSxTQUFTLENBQUNDLE1BVkksQ0FXaENELFNBQVMsQ0FBQ0UsSUFBVixDQUFlLENBQ2IsTUFBUyxxQkFESSxDQUViLG9CQUF1QkosQ0FBRyxLQUZiLENBQWYsQ0FYZ0MsQ0FnQmhDSyxPQUFPLENBQUNDLEdBQVIsQ0FBWSxvRkFBWixDQUVILENBckJVLENBc0JYQyxlQUFlLENBQUUsMEJBQVksQ0FDM0I7QUFDQTtBQUVBO0FBREF0QixhQUFhLENBQUcsRUFIVyxDQUszQkcsV0FBVyxDQUFDYSxTQUFaLENBQXNCZCxDQUFJLENBQUNPLFdBQTNCLENBQ0QsQ0E1QlUsQ0E2QlhjLE9BQU8sQ0FBRSxDQUFDLFdBQUQsQ0E3QkUsQ0E4QlhDLFVBQVUsQ0FBRSxDQUNWQyxXQUFXLENBQUUseUJBREgsQ0FFVixhQUFjLGlDQUZKLENBOUJELENBVkosQ0E2Q1RDLFlBQVksQ0FBRSx1QkFBVyxDQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUlDLENBQUFBLENBQU0sQ0FBR0MsUUFBUSxDQUFDQyxjQUFULENBQXdCLGlCQUF4QixDQUFiLENBQ0EzQixDQUFJLENBQUNRLFFBQUwsQ0FBZ0IsR0FBSVIsQ0FBQUEsQ0FBSSxDQUFDNEIsVUFBVCxDQUFvQjVCLENBQUksQ0FBQ1MsV0FBekIsQ0FBc0NnQixDQUF0QyxDQUNqQixDQXBEUSxDQXFEVEcsVUFBVSxDQUFFLG9CQUFTQyxDQUFULENBQWdCQyxDQUFoQixDQUEyQixJQUNqQ0MsQ0FBQUEsQ0FBSyxDQUFHLElBRHlCLENBSWpDQyxDQUFRLENBQUcsU0FBY0gsQ0FBZCxDQUFxQixDQUNsQ0ksR0FBRyxDQUFFLGFBQVNBLENBQVQsQ0FBYyxDQUFFRixDQUFLLENBQUNHLFNBQU4sQ0FBa0JELENBQU0sQ0FEWCxDQUFyQixDQUpzQixDQUdyQztBQUtBLEtBQUtFLE1BQUwsQ0FBYyxTQUFTTixDQUFULENBQWdCLENBQzVCTyxRQUFRLENBQUNELE1BQVQsQ0FDRUUsS0FBSyxDQUFDQyxhQUFOLENBQW9CQyxVQUFwQixDQUFnQ1YsQ0FBaEMsQ0FBdUMsSUFBdkMsQ0FERixDQUVFQyxDQUZGLENBSUQsQ0Fib0MsQ0FjckMsS0FBS0ssTUFBTCxDQUFZSCxDQUFaLENBQ0QsQ0FwRVEsQ0FxRVRRLE1BQU0sQ0FBRSxpQkFBVyxDQUNmO0FBQ0EsR0FBSUMsQ0FBQUEsQ0FBYyxDQUFHMUMsQ0FBQyxDQUFDMkMsSUFBRixDQUFPMUMsQ0FBSSxDQUFDRSxRQUFaLENBQXNCLFNBQVN5QyxDQUFULENBQWEsQ0FFcEQzQyxDQUFJLENBQUNHLEdBQUwsQ0FBWUgsQ0FBSSxDQUFDQyxXQUFOLENBQW1CMkMsTUFBbkIsR0FBNEJ6QyxHQUE1QixDQUFrQyxHQUZPLENBRUY7QUFGRSxHQUdoRDBDLENBQUFBLENBQVUsQ0FBRzlDLENBQUMsQ0FBQzRDLENBQUQsQ0FBRCxDQUFNQyxNQUFOLEdBQWV6QyxHQUhvQixDQUtoRDJDLENBQWEsQ0FBRy9DLENBQUMsQ0FBQzRDLENBQUQsQ0FBRCxDQUFNSSxXQUFOLEVBTGdDLENBR2Y7QUFDckM7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUsvQyxDQUFJLENBQUNHLEdBQUwsRUFBWTBDLENBQVosRUFBMEI3QyxDQUFJLENBQUNHLEdBQUwsRUFSWCxDQUFPMEMsQ0FBUCxHQUE0QkMsQ0FRaEQsQ0FDSTtBQUNBLE1BQU8vQyxDQUFBQSxDQUFDLENBQUM0QyxDQUFELENBRWYsQ0FsQm9CLENBQXJCLENBbUJBO0FBQ0EsR0FBNkIsQ0FBekIsRUFBQUYsQ0FBYyxDQUFDekIsTUFBbkIsQ0FBZ0MsQ0FFM0JoQixDQUFJLENBQUNDLFdBQU4sQ0FBbUIrQyxXQUFuQixDQUErQixjQUEvQixDQUY0QixDQUc1QmhELENBQUksQ0FBQ00sY0FBTCxHQUg0QixDQUk1QjtBQUNBO0FBTDRCLEdBTXhCMkMsQ0FBQUEsQ0FBSyxDQUFHbEQsQ0FBQyxDQUFDMEMsQ0FBYyxDQUFDLENBQUQsQ0FBZixDQUFELENBQXFCUyxJQUFyQixDQUEwQixpQkFBMUIsQ0FOZ0IsQ0FPeEJDLENBQVEsR0FDUnBELENBQUMsQ0FBQzBDLENBQWMsQ0FBQyxDQUFELENBQWYsQ0FBRCxDQUFxQlMsSUFBckIsQ0FBMEIsb0JBQTFCLENBRFEsRUFFUm5ELENBQUMsQ0FBQzBDLENBQWMsQ0FBQyxDQUFELENBQWYsQ0FBRCxDQUFxQlMsSUFBckIsQ0FBMEIsb0JBQTFCLENBVHdCLENBZXhCRCxDQUFLLEdBQUtqRCxDQUFJLENBQUNPLFdBZlMsR0FnQnhCVyxPQUFPLENBQUNDLEdBQVIsQ0FBWSxxQkFBdUI4QixDQUFuQyxDQWhCd0IsQ0FpQnBCRSxDQWpCb0IsQ0FrQnBCbEQsV0FBVyxDQUFDYSxTQUFaLENBQXNCbUMsQ0FBdEIsQ0FBNkIsQ0FBQ0csUUFBUSxHQUFULENBQTdCLENBbEJvQixDQW9CcEJuRCxXQUFXLENBQUNhLFNBQVosQ0FBc0JtQyxDQUF0QixDQXBCb0IsQ0FzQnhCakQsQ0FBSSxDQUFDTyxXQUFMLENBQW1CMEMsQ0F0QkssQ0F3Qi9CLENBeEJELEtBd0JxQyxDQUExQixHQUFBUixDQUFjLENBQUN6QixNQUFmLEVBQXdELENBQXpCLEVBQUF5QixDQUFjLENBQUN6QixNQXhCekQsSUF5QktoQixDQUFJLENBQUNDLFdBQU4sQ0FBbUJvRCxRQUFuQixDQUE0QixjQUE1QixDQXpCSixDQTBCSXJELENBQUksQ0FBQ00sY0FBTCxHQTFCSixDQTZCSCxDQXhIUSxDQXlIVGdELFNBQVMsQ0FBRSxvQkFBVyxDQUNwQnRELENBQUksQ0FBQ0csR0FBTCxDQUFZSCxDQUFJLENBQUNDLFdBQU4sQ0FBbUIyQyxNQUFuQixHQUE0QnpDLEdBRG5CLENBRXBCSCxDQUFJLENBQUNJLE1BQUwsQ0FBZUosQ0FBSSxDQUFDQyxXQUFOLENBQW1Cc0QsSUFBbkIsQ0FBd0IsT0FBeEIsRUFBaUNuRCxNQUFqQyxFQUZNLENBR3BCSixDQUFJLENBQUNLLE1BQUwsQ0FBYyxDQUFPTCxDQUFJLENBQUNHLEdBQVosR0FBMEJILENBQUksQ0FBQ0ksTUFDOUMsQ0E3SFEsQ0FBYixDQWdJQTtBQUtBO0FBUUE7QUFaQUosQ0FBSSxDQUFDQyxXQUFMLENBQW1CRixDQUFDLENBQUMsY0FBRCxDQW5JWCxDQW9JVEMsQ0FBSSxDQUFDRSxRQUFMLENBQWdCSCxDQUFDLENBQUMscUJBQUQsQ0FwSVIsQ0FxSVRDLENBQUksQ0FBQ3NELFNBQUwsRUFySVMsQ0F3SVR2RCxDQUFDLENBQUV5RCxNQUFGLENBQUQsQ0FBWUMsTUFBWixDQUFtQixVQUFXLENBQzFCO0FBQ0E7QUFDQTtBQUNBekQsQ0FBSSxDQUFDc0QsU0FBTCxFQUNILENBTEQsQ0F4SVMsQ0FnSlRyRCxXQUFXLENBQUN5RCxFQUFaLENBQWUsT0FBZixDQUF3QixVQUFzQixDQUMxQyxHQUFJQyxDQUFBQSxDQUFZLEdBQWhCLENBQ0E1RCxDQUFDLENBQUN5RCxNQUFELENBQUQsQ0FBVUksTUFBVixDQUFpQixVQUFXLENBQzFCRCxDQUFZLEdBQ2IsQ0FGRCxDQUYwQyxDQUsxQ0UsV0FBVyxDQUFDLFVBQVcsQ0FDakJGLENBRGlCLEdBRW5CM0QsQ0FBSSxDQUFDd0MsTUFBTCxFQUZtQixDQUduQm1CLENBQVksR0FITyxDQUt0QixDQUxVLENBS1IsRUFMUSxDQUwrQixDQVlMLENBQWpDLEVBQUE1RCxDQUFDLENBQUMsbUJBQUQsQ0FBRCxDQUF1QmlCLE1BWmUsRUFheENoQixDQUFJLENBQUN3QixZQUFMLEVBRUwsQ0FmRCxDQWhKUyxDQWdLVHZCLFdBQVcsQ0FBQ2EsU0FBWixDQUFzQixRQUF0QixDQUNILENBaktELENBaUtHZ0QsTUFqS0gsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIHVzZSBzdHJpY3QgKi9cblxuY29uc3QgX3Bsb3QgPSB7fTtcbl9wbG90LnNlYXJjaEl0ZW1JRHMgPSBbXTtcblxuKGZ1bmN0aW9uKCQpIHtcblxuICAgIGNvbnN0IHBsb3QgPSB7XG4gICAgICAgIHNjYXR0ZXJwbG90OiBudWxsLFxuICAgICAgICB3cmFwcGVyczogW10sXG4gICAgICAgIHRvcDogbnVsbCxcbiAgICAgICAgaGVpZ2h0OiBudWxsLFxuICAgICAgICBib3R0b206IG51bGwsXG4gICAgICAgIGlzVHJhbnNpdGlvbmFsOiBmYWxzZSxcbiAgICAgICAgYWN0aXZlU3RhdGU6ICdzdGF0ZTEnLFxuICAgICAgICAvLyBzZWFyY2hJdGVtSURzOiBbXSxcbiAgICAgICAgc2VhcmNoRWw6IG51bGwsXG4gICAgICAgIHNlYXJjaFByb3BzOiB7IC8vIFByb3BzIHBhc3NlZCBpbiB0byBpbml0IHRoZSBzZWFyY2ggaW5wdXQocylcbiAgICAgICAgICBhbGdvbGlhSWQ6ICdRUEoxMldTVlI0JyxcbiAgICAgICAgICBhbGdvbGlhS2V5OiAnYmFlOWU0NjA0ZGJkMjYzY2M0N2M0OGJmYjMwZGQ1ZGMnLFxuICAgICAgICAgIG9uU3VnZ2VzdGlvblNlbGVjdGVkOiBmdW5jdGlvbihoaXQpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdoaXQnKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGhpdCk7XG4gICAgICAgICAgICBpZiAoX3Bsb3QgJiYgX3Bsb3Quc2VhcmNoSXRlbUlEcykge1xuICAgICAgICAgICAgICBfcGxvdC5zZWFyY2hJdGVtSURzWzBdID0gaGl0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coX3Bsb3Quc2VhcmNoSXRlbUlEcyk7XG4gICAgICAgICAgICBzY2F0dGVycGxvdC5sb2FkU3RhdGUocGxvdC5hY3RpdmVTdGF0ZSk7XG4gICAgICAgICAgICAvLyBHQSBFdmVudCBzdWJtaXNzaW9uXG4gICAgICAgICAgICBjb25zdCAkaGlnaGxpZ2h0ZWREaXN0cmljdCA9ICcnO1xuICAgICAgICAgICAgaWYgKCEhZGF0YUxheWVyICYmIChkYXRhTGF5ZXIubGVuZ3RoID49IDMpKSB7XG4gICAgICAgICAgICAgIGRhdGFMYXllci5wdXNoKHtcbiAgICAgICAgICAgICAgICAnZXZlbnQnOiAnZGlzdHJpY3RIaWdobGlnaHRlZCcsXG4gICAgICAgICAgICAgICAgJ2hpZ2hsaWdodGVkRGlzdHJpY3QnOiBoaXRbJ25hbWUnXVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkYXRhTGF5ZXIgbm90IGF2YWlsYWJsZS4gU2tpcHBpbmcgYW5hbHl0aWNzIHJlcG9ydGluZyBmb3IgaGlnaGxpZ2h0ZWQgaXRlbSBzZWxlY3QuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvblNlbGVjdGVkQ2xlYXI6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICAgICAgLy8gQ2xlYXIgc2VhcmNoIGl0ZW0gYXJyYXlcbiAgICAgICAgICAgIHNlYXJjaEl0ZW1JRHMgPSBbXTtcbiAgICAgICAgICAgIC8vIFJlbG9hZCBzdGF0ZVxuICAgICAgICAgICAgc2NhdHRlcnBsb3QubG9hZFN0YXRlKHBsb3QuYWN0aXZlU3RhdGUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5kaWNlczogWydkaXN0cmljdHMnXSxcbiAgICAgICAgICBpbnB1dFByb3BzOiB7XG4gICAgICAgICAgICBwbGFjZWhvbGRlcjogJ0hpZ2hsaWdodCBhIGRpc3RyaWN0Li4uJyxcbiAgICAgICAgICAgICdhcmlhLWxhYmVsJzogJ0VudGVyIGEgZGlzdHJpY3QgbmFtZSB0byBzZWFyY2gnXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByZW5kZXJTZWFyY2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIC8vICRlbGVtZW50cyA9ICQoJy5zZWFyY2gtY29tcG9uZW50Jyk7XG4gICAgICAgICAgLy8gJGVsZW1lbnRzLmVhY2goZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAvLyAgIChwbG90LnNlYXJjaEVsKS5wdXNoKG5ldyBwbG90LnNlYXJjaEluaXQocGxvdC5zZWFyY2hQcm9wcywgZWwpKTtcbiAgICAgICAgICAvLyB9KTtcbiAgICAgICAgICB2YXIgcm9vdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaENvbXBvbmVudCcpO1xuICAgICAgICAgIHBsb3Quc2VhcmNoRWwgPSBuZXcgcGxvdC5zZWFyY2hJbml0KHBsb3Quc2VhcmNoUHJvcHMsIHJvb3RFbCk7XG4gICAgICAgIH0sXG4gICAgICAgIHNlYXJjaEluaXQ6IGZ1bmN0aW9uKHByb3BzLCBjb250YWluZXIpIHtcbiAgICAgICAgICB2YXIgX3NlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgLy8gYWRkIHJlZmVyZW5jZSB0byB0aGUgY29tcG9uZW50IHRvIHByb3BzXG4gICAgICAgICAgdmFyIHJlZlByb3BzID0gT2JqZWN0LmFzc2lnbihwcm9wcywge1xuICAgICAgICAgICAgcmVmOiBmdW5jdGlvbihyZWYpIHsgX3NlbGYuY29tcG9uZW50ID0gcmVmOyB9XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB0aGlzLnJlbmRlciA9IGZ1bmN0aW9uKHByb3BzKSB7XG4gICAgICAgICAgICBSZWFjdERPTS5yZW5kZXIoXG4gICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoU2VkYVNlYXJjaCwgcHJvcHMsIG51bGwpLFxuICAgICAgICAgICAgICBjb250YWluZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMucmVuZGVyKHJlZlByb3BzKTtcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCd1cGRhdGUnKTtcbiAgICAgICAgICAgIHZhciBhY3RpdmVXcmFwcGVycyA9ICQuZ3JlcChwbG90LndyYXBwZXJzLCBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIC8vIEdldCB0b3AgYW5kIGJvdHRvbSB5IGNvb3JkcyBvZiB3cmFwcGVyXG4gICAgICAgICAgICAgICAgcGxvdC50b3AgPSAocGxvdC5zY2F0dGVycGxvdCkub2Zmc2V0KCkudG9wICsgMTIwOyAvLyArIDQ2MjtcbiAgICAgICAgICAgICAgICB2YXIgd3JhcHBlclRvcCA9ICQoZWwpLm9mZnNldCgpLnRvcDsgLy8gJChlbCkub2Zmc2V0KCkudG9wIC0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgICAgIC8vIHZhciB3cmFwcGVySGVpZ2h0ID0gJChlbCkuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgdmFyIHdyYXBwZXJIZWlnaHQgPSAkKGVsKS5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgICAgIHZhciB3cmFwcGVyQm90dG9tID0gTnVtYmVyKHdyYXBwZXJUb3ApICsgTnVtYmVyKHdyYXBwZXJIZWlnaHQpO1xuICAgICAgICAgICAgICAgIC8vIElmIHBsb3QgdG9wIG9yIGJvdHRvbSBhcmUgd2l0aGluXG4gICAgICAgICAgICAgICAgLy8gYWRkIHRvIGFjdGl2ZVdyYXBwZXJzLlxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdwbG90LnRvcCA9ICcgKyBwbG90LnRvcCk7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ29mZnNldCgpLnRvcCA9ICcgKyAkKGVsKS5vZmZzZXQoKS50b3ApO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdzY3JvbGx0b3AgPSAnICsgJCh3aW5kb3cpLnNjcm9sbFRvcCgpKTtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnd3JhcHBlclRvcCA9ICcgKyB3cmFwcGVyVG9wKTtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnd3JhcHBlckJvdHRvbSA9ICcgKyB3cmFwcGVyQm90dG9tKTtcbiAgICAgICAgICAgICAgICBpZiAoKHBsb3QudG9wID49IHdyYXBwZXJUb3AgJiYgcGxvdC50b3AgPD0gd3JhcHBlckJvdHRvbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ0l0XFwncyB3aXRoaW4gYSB3cmFwcGVyLicpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJChlbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhhY3RpdmVXcmFwcGVycyk7XG4gICAgICAgICAgICBpZiAoYWN0aXZlV3JhcHBlcnMubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnT25lIGl0ZW0gaW4gYWN0aXZlV3JhcHBlcnMuJyk7XG4gICAgICAgICAgICAgICAgKHBsb3Quc2NhdHRlcnBsb3QpLnJlbW92ZUNsYXNzKCd0cmFuc2l0aW9uYWwnKTtcbiAgICAgICAgICAgICAgICBwbG90LmlzVHJhbnNpdGlvbmFsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgLy8gU2V0IHN0YXRlIHRvIHRoZSBmaXJzdCBvbmUuXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYWN0aXZlV3JhcHBlcnNbMF0pO1xuICAgICAgICAgICAgICAgIHZhciBzdGF0ZSA9ICQoYWN0aXZlV3JhcHBlcnNbMF0pLmF0dHIoJ2RhdGEtcGxvdC1zdGF0ZScpO1xuICAgICAgICAgICAgICAgIHZhciBub3RtZXJnZSA9XG4gICAgICAgICAgICAgICAgICAgICQoYWN0aXZlV3JhcHBlcnNbMF0pLmF0dHIoJ2RhdGEtcGxvdC1ub3RtZXJnZScpID9cbiAgICAgICAgICAgICAgICAgICAgJChhY3RpdmVXcmFwcGVyc1swXSkuYXR0cignZGF0YS1wbG90LW5vdG1lcmdlJykgOlxuICAgICAgICAgICAgICAgICAgICBmYWxzZTtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICAvLyAgICAgJ1N0YXRlID0gJyArIHN0YXRlICtcbiAgICAgICAgICAgICAgICAvLyAgICAgJy4gQWN0aXZlIHN0YXRlID0gJyArIHBsb3QuYWN0aXZlU3RhdGUgK1xuICAgICAgICAgICAgICAgIC8vICAgICAnLiBOb3RNZXJnZSA9ICcgKyBTdHJpbmcobm90bWVyZ2UpICsgJy4nICk7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlICE9PSBwbG90LmFjdGl2ZVN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2FkaW5nIG5ldyBzdGF0ZSAnICsgc3RhdGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobm90bWVyZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYXR0ZXJwbG90LmxvYWRTdGF0ZShzdGF0ZSwge25vdE1lcmdlOiB0cnVlfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2F0dGVycGxvdC5sb2FkU3RhdGUoc3RhdGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHBsb3QuYWN0aXZlU3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZVdyYXBwZXJzLmxlbmd0aCA9PT0gMCB8fCBhY3RpdmVXcmFwcGVycy5sZW5ndGggPj0gMSkge1xuICAgICAgICAgICAgICAgIChwbG90LnNjYXR0ZXJwbG90KS5hZGRDbGFzcygndHJhbnNpdGlvbmFsJyk7XG4gICAgICAgICAgICAgICAgcGxvdC5pc1RyYW5zaXRpb25hbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ0luIHRyYW5zaXRpb24uIFN0YXRlID0gJyArIHN0YXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZ2V0Q29vcmRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBwbG90LnRvcCA9IChwbG90LnNjYXR0ZXJwbG90KS5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgcGxvdC5oZWlnaHQgPSAocGxvdC5zY2F0dGVycGxvdCkuZmluZCgnPiBkaXYnKS5oZWlnaHQoKTtcbiAgICAgICAgICBwbG90LmJvdHRvbSA9IE51bWJlcihwbG90LnRvcCkgKyBOdW1iZXIocGxvdC5oZWlnaHQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vIEdldCB0b3AgYW5kIGJvdHRvbSB5IGNvb3JkcyBvZiB0aGUgc2NhdHRlcnBsb3RcbiAgICBwbG90LnNjYXR0ZXJwbG90ID0gJCgnI3NjYXR0ZXJwbG90Jyk7XG4gICAgcGxvdC53cmFwcGVycyA9ICQoJy5zdGF0ZS1kZXNjLXdyYXBwZXInKTtcbiAgICBwbG90LmdldENvb3JkcygpO1xuXG4gICAgLy8gUmVzZXQgdGhlbSBpZiB0aGUgc2NyZWVuIGlzIHJlc2l6ZWRcbiAgICAkKCB3aW5kb3cgKS5yZXNpemUoZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIHBsb3QudG9wID0gKHBsb3Quc2NhdHRlcnBsb3QpLm9mZnNldCgpLnRvcDtcbiAgICAgICAgLy8gcGxvdC5oZWlnaHQgPSAocGxvdC5zY2F0dGVycGxvdCkuZmluZCgnPiBkaXYnKS5oZWlnaHQoKTtcbiAgICAgICAgLy8gcGxvdC5ib3R0b20gPSBOdW1iZXIocGxvdC50b3ApICsgTnVtYmVyKHBsb3QuaGVpZ2h0KTtcbiAgICAgICAgcGxvdC5nZXRDb29yZHMoKTtcbiAgICB9KTtcblxuICAgIC8vIE9ubHkgdHJpZ2dlciBzY3JvbGwgZXZlciA1MG1zIHNvIGxlc3MgcmVzb3VyY2VzXG4gICAgc2NhdHRlcnBsb3Qub24oJ3JlYWR5JywgZnVuY3Rpb24oc2NhdHRlcnBsb3QpIHtcbiAgICAgICAgdmFyIHVzZXJTY3JvbGxlZCA9IGZhbHNlO1xuICAgICAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHVzZXJTY3JvbGxlZCA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAodXNlclNjcm9sbGVkKSB7XG4gICAgICAgICAgICBwbG90LnVwZGF0ZSgpOyAvLyBAbGFuZSwgZGlzYWJsZWQgZGVmYXVsdCBzY3JvbGwgZXZlbnQgaW5pdCBoZXJlLlxuICAgICAgICAgICAgdXNlclNjcm9sbGVkID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9LCA1MCk7XG5cbiAgICAgICAgaWYgKCQoJy5zZWFyY2gtY29tcG9uZW50JykubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICBwbG90LnJlbmRlclNlYXJjaCgpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgc2NhdHRlcnBsb3QubG9hZFN0YXRlKCdzdGF0ZTEnKTtcbn0pKGpRdWVyeSk7XG4iXX0=